<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PyScript Hello World</title>
  <py-config>
    [[runtimes]]
    src = "runtime/pyodide.js"
    name = "pyodide-0.21.3"
    lang = "python"
  </py-config>
  <link rel="icon" type="image/png" href="/icon-128.png" />
  <link rel="stylesheet" href="runtime/pyscript.css" />
  <link rel="stylesheet" href="./popup.css" />
  <script defer src="runtime/pyscript.js"></script>
  <script src="popup.js"></script>
</head>
<body>
  <div id="hello"></div>
  <div id="hrefData" style="display: none;"></div> <!-- Hidden div with data attribute -->
  <div id="hrefOutput" style="display: none;"></div> 
</body>

<py-script>
from pyodide.http import pyfetch

href_div = Element("hrefData")
href = href_div.element.getAttribute("data-href")  # Get the data-href attribute

if href != 'Not found':
  href = href.split(' ')
  if href[0] == 'Visit':
    href = '_'.join(href[2:-1])
  else:
    href = '_'.join(href[1:])

  response = await pyfetch(f'https://en.wikipedia.org/api/rest_v1/page/summary/{href.lower()}')
  data = await response.json()
  data = data.get("extract", "No extract available.")
  href_output_div = document.getElementById("hrefOutput")
  href_output_div.innerHTML = f"<p><b>Content: {data}</b></p>"

</py-script>
</html>
